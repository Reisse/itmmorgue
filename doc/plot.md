# Сценарий игры ITMMORGUE

## Сюжетная линия 

TODO

## Игровая механика

### Бег и ходьба
  * cells_i = floor(speed_i) + (rnd() < (speed_i - floor(speed_i))), где rnd() -- рандом uniform от 0..1
  * при движении игрока 7913(numpad): delta_x = delta_y = cells(speed / sqrt(2))
  * при движении спеллов, стрел, летающих объектов: cells_i(), а попадание в цель наступает только при пересечении с возможной целью
  * speed == 1 -- ходьба, speed > 1 -- бег. Переключается модификатором
  * либо бежим, либо идём. Среднего не дано
  * бег тратит стамину
    * при маленькой стамине бег не работает, надо передохнуть

## Система скиллов

* любой игрок может юзать любой скилл
  * в зависимости от умений персонажа выбирается эффект скилла
  * скилл может нанести урон или иметь отрицательный эффект при низком уровне владения

## Относится к игрокам

### Система рас, родов и классов

Рас, родов и классов (см. классы_NPC) не будет.
Специализация прокачивается пассивно в зависимости от используемых скиллов.

### Система вещей

В начале игры все могут выбрать некоторое количество предметов на стартовую сумму денег.
Эти предметы повышают соответствющие умения до некоторого небольшого уровня владения, чтобы не наносить урон владельцу при их использовании.

## Неигровые персонажи implements Movable

* агрессия мобов
  * в зависимости от действий игрока
  * в зависимости от качеств игрока (навыки, снаряжение, скиллы, баффы(?))
  * в зависимости от лояльности (взаимоотношение с игровым миром) игрока(?), группы(?)
* страх мобов
  * оценка вероятных противников
* оценка своей победы в битве -- нужно бежать, игнорировать или атаковать
* системное уведомление при смерти сюжетных мобов
* имеют флаг: "сюжетный"
* возможность (флаг) повлиять на main routine других мобов (напр. купить что-то у торговца)

### Main routine

Должен быть стэк из листов рутин. Например, лист -- догнать лису + убить лису.

* стоять на месте
* ходить в пределах заданной области (как задавать область?): торговец на рынке или лиса в лесу
  * область относительно чанков (строений, городов, опушек)
  * область может быть составной (вложенной)
* бежать по своим делам (сюжет, бот, заранее продуманные кейсы)
* патрулировать заданный по waypoint путь
* следовать за персонажем

#### Сопровождение игроков

* подстраивается под скорость
  * может умышленно опережать
  * может умышленно отставать
  * может стараться идти в темпе следуемого объекта

### Special routine

Сложная последовательность действий, в основном, описывающая действия сюжетных персонажей.

### Микротаски

Генерируются основной рутиной. Например:
* открыть дверь
* дойти в точку
* обойти в болото
* ждать
* переключиться на бег
* сдвинуться в направлении

Некоторые сюжетные микротаски (напр. скрафтить хитрый меч-леденец) выдаются только в рамках special routine.

## Описание местности

TODO описать мир

128x40
10x4 cities
48 forest
16 plains
48 caves

## Боевая система

* friendly fire
  * любой массовый урон необходимо распределять по всей площади, включая friendly fire (как игрок-игрок, так и монстр-монстр)
  * необходимо продумать скорость/перемещение, чтобы была возможность заманивать одних монстров под атаки других

