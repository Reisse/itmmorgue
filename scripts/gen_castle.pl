#!/usr/bin/perl
# made by: KorG

use strict;
use v5.18;
use warnings;
no warnings 'experimental';
use utf8;
binmode STDOUT, ':utf8';
use lib '.';

use gen;

# Read a level into memory from STDIN
gen->read_level();

my @CASTLE = map { [ split // ] } (
   "###############" ,
   "#_____________#" ,
   "#____#___#____#" ,
   "#____#___#____#" ,
   "#____#___#____#" ,
   "#____#_F_#____#" ,
   "#____#___#____#" ,
   "#____#####____#" ,
   "#_____________#" ,
   "######___######" ,
   "     #___#     " ,
   "^ ^ ^#___#^ ^ ^" ,
   " ^ ^  #_#  ^ ^ " ,
   "^ ^ ^ 111 ^ ^ ^" ,
);

# Rotate the building somehow
gen->array_rotate(\@CASTLE);

# Put some buildings on the level
gen->overlay_anywhere(\@CASTLE, 2, ',');

gen->overlay_anywhere([ map { [ split // ] } (
   "...........................                    ...........................",
   ".#######..#######..#######.                    .#######..#######..#######.",
   ".#_____#..#_____#..#_____#.                    .#_____#..#_____#..#_____#.",
   ".##___##..##___##..##___##.                    .##___##..##___##..##___##.",
   "..#___#....#___#....#___#........................#___#....#___#....#___#..",
   " .#___######___######___###..####.4####4.####..###___######___######___#. ",
   " .#_______________________#..#__#.4+__+4.#__#..#_______________________#. ",
   " ..#______________________####__####__####__####______________________#.. ",
   "  ..#________________________________________________________________#..  ",
   "   ..#___#####____#####____________________________#####____#####___#..   ",
   "    .#___#___#____#___#____________________________#___#____#___#___#.    ",
   "    .#___#___#____#___#____________________________#___#____#___#___#.    ",
   "    .#___#___#____#___#____________####____________#___#____#___#___#.    ",
   "    .#___#_l_#____#_l_#_________###_##_###_________#_l_#____#_l_#___#.    ",
   "    .#___#___#____#___#_______###___##___###_______#___#____#___#___#.    ",
   "    .#___#####____#####______##_____##_____##______#####____#####___#.    ",
   "    .#_______________________+______##______+_______________________#.    ",
   "    .#_______________________#______##______#_______________________#.    ",
   "    .#_______________________#____#_##_#____#_______________________#.    ",
   "    .#_______________________+______##______+_____________________C_#.    ",
   "    .#_______________________#______##______#_______________________#.    ",
   "    .################################################################.    ",
   "    ..................................................................    ",
)]);

@CASTLE = map { [ split // ] } (
   "                             .........                           ",
   "                          ....#######....                        ",
   "                        ...###___l___###...                      ",
   "                       ..##_____________##..                     ",
   "                       .##_______________##.                     ",
   "                      ..#_________________#..                    ",
   "                      .##_________________##.                    ",
   "              .........#___________________#.........            ",
   "             ..###########+#########################..           ",
   "             .#________#____________________________#......      ",
   "             .#_______#_____________________________#......      ",
   "             .#_______+_____________________________#......      ",
   "             .#_______#_______###############_______#......      ",
   "       .......#______#_____###_______###_____####___#.4.....     ",
   "   .....#######______#__###_____________###______#+###+####....  ",
   "  ..#####_____#______###___________________##_______#____#####.. ",
   "...##_____l___#______#_______________________#______+________##..",
   ".##___________#______#_______________________#______#__________##",
   ".#____________#______#___________#___________#______#___________#",
   ".##___________#______#_________##____________#______#__________##",
   "...##_________+______#________##_____________#______#________##..",
   "  ..#####_____#_______##_C__##_____________###______#____#####.. ",
   "   .....########+#______####____________###__#______#######....  ",
   "       .......#___####_____###.......###_____#______#.......     ",
   "             .#_______######________________#_______#.           ",
   "             .#_____________________________#_______#.           ",
   "             .#_____________________________#_______#.           ",
   "             .#____________________________#___l____#.           ",
   "             ..#########################+###########..           ",
   "              .........#___________________#.........            ",
   "                      .##__________l______##.                    ",
   "                      ..#_________________#..                    ",
   "                       .##_______________##.                     ",
   "                       ..##_____________##..                     ",
   "                        ...###_______###...                      ",
   "                          ....#######....                        ",
   "                             .........                           ",
);

# Rotate the building somehow
gen->array_rotate(\@CASTLE, rand() >= 0.5 ? 0 : 2);

# Put some buildings on the level
gen->overlay_anywhere(\@CASTLE);

# Print the surface
gen->print_level();

#TODO Generate @CASTLE dynamically
