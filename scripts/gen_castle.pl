#!/usr/bin/perl
# made by: KorG

use strict;
use v5.18;
use warnings;
no warnings 'experimental';
use utf8;
binmode STDOUT, ':utf8';
use lib '.';

use gen;

# Read a level into memory from STDIN
gen->read_level();

my @CASTLE = map { [ split // ] } (
   "###############" ,
   "#_____________#" ,
   "#____#___#____#" ,
   "#____#___#____#" ,
   "#____#___#____#" ,
   "#____#_C_#____#" ,
   "#____#___#____#" ,
   "#____#####____#" ,
   "#_____________#" ,
   "######___######" ,
   "     #___#     " ,
   "^ ^ ^#___#^ ^ ^" ,
   " ^ ^  #_#  ^ ^ " ,
   "^ ^ ^ 444 ^ ^ ^" ,
);

# Rotate the building somehow
gen->array_rotate(\@CASTLE);

# Put some buildings on the level
gen->overlay_anywhere(\@CASTLE, 2, ',');

gen->overlay_anywhere([ map { [ split // ] } (
   "...........................                    ...........................",
   ".#######..#######..#######.                    .#######..#######..#######.",
   ".#_____#..#_____#..#_____#.                    .#_____#..#_____#..#_____#.",
   ".##___##..##___##..##___##.                    .##___##..##___##..##___##.",
   "..#___#....#___#....#___#........................#___#....#___#....#___#..",
   " .#___######___######___###..####.4####4.####..###___######___######___#. ",
   " .#_______________________#..#__#.4+__+4.#__#..#_______________________#. ",
   " ..#______________________####__####__####__####______________________#.. ",
   "  ..#________________________________________________________________#..  ",
   "   ..#___#####____#####____________________________#####____#####___#..   ",
   "    .#___#___#____#___#____________________________#___#____#___#___#.    ",
   "    .#___#___#____#___#____________________________#___#____#___#___#.    ",
   "    .#___#___#____#___#____________####____________#___#____#___#___#.    ",
   "    .#___#_l_#____#_l_#_________###_##_###_________#_l_#____#_l_#___#.    ",
   "    .#___#___#____#___#_______###___##___###_______#___#____#___#___#.    ",
   "    .#___#####____#####______##_____##_____##______#####____#####___#.    ",
   "    .#_______________________+______##______+_______________________#.    ",
   "    .#_______________________#______##______#_______________________#.    ",
   "    .#_______________________#____#_##_#____#_______________________#.    ",
   "    .#_______________________+______##______+_____________________C_#.    ",
   "    .#_______________________#______##______#_______________________#.    ",
   "    .################################################################.    ",
   "    ..................................................................    ",
)]);

@CASTLE = map { [ split // ] } (
   "                             .........                           ",
   "                          ....#######....                        ",
   "                        ...###,,,l,,,###...                      ",
   "                       ..##,,,,,,,,,,,,,##..                     ",
   "                       .##,,,,,,,,,,,,,,,##.                     ",
   "                      ..#,,,,,,,,,,,,,,,,,#..                    ",
   "                      .##,,,,,,,,,,,,,,,,,##.                    ",
   "              .........#,,,,,,,,,,,,,,,,,,,#.........            ",
   "             ..###########+#########################..           ",
   "             .#,,,,,,,,#,,,,,,,,,,,,,,,,,,,,,,,,,,,,#......      ",
   "             .#,,,,,,,#,,,,,,,,,,,,,,,,,,,,,,,,,,,,,#......      ",
   "             .#,,,,,,,+,,,,,,,,,,,,,,,,,,,,,,,,,,,,,#......      ",
   "             .#,,,,,,,#,,,,,,,###############,,,,,,,#......      ",
   "       .......#,,,,,,#,,,,,###,,,,,,,###,,,,,####,,,#.4.....     ",
   "   .....#######,,,,,,#,,###,,,,,,,,,,,,,###,,,,,,#+###+####....  ",
   "  ..#####,,,,,#,,,,,,###,,,,,,,,,,,,,,,,,,,##,,,,,,,#,,,,#####.. ",
   "...##,,,,,l,,,#,,,,,,#,,,,,,,,,,,,,,,,,,,,,,,#,,,,,,+,,,,,,,,##..",
   ".##,,,,,,,,,,,#,,,,,,#,,,,,,,,,,,,,,,,,,,,,,,#,,,,,,#,,,,,,,,,,##",
   ".#,,,,,,,,,,,,#,,,,,,#,,,,,,,,,,,#,,,,,,,,,,,#,,,,,,#,,,,,,,,,,,#",
   ".##,,,,,,,,,,,#,,,,,,#,,,,,,,,,##,,,,,,,,,,,,#,,,,,,#,,,,,,,,,,##",
   "...##,,,,,,,,,+,,,,,,#,,,,,,,,##,,,,,,,,,,,,,#,,,,,,#,,,,,,,,##..",
   "  ..#####,,,,,#,,,,,,,##,C,,##,,,,,,,,,,,,,###,,,,,,#,,,,#####.. ",
   "   .....########+#,,,,,,####,,,,,,,,,,,,###,,#,,,,,,#######....  ",
   "       .......#,,,####,,,,,###.......###,,,,,#,,,,,,#.......     ",
   "             .#,,,,,,,######,,,,,,,,,,,,,,,,#,,,,,,,#.           ",
   "             .#,,,,,,,,,,,,,,,,,,,,,,,,,,,,,#,,,,,,,#.           ",
   "             .#,,,,,,,,,,,,,,,,,,,,,,,,,,,,,#,,,,,,,#.           ",
   "             .#,,,,,,,,,,,,,,,,,,,,,,,,,,,,#,,,l,,,,#.           ",
   "             ..#########################+###########..           ",
   "              .........#,,,,,,,,,,,,,,,,,,,#.........            ",
   "                      .##,,,,,,,,,,l,,,,,,##.                    ",
   "                      ..#,,,,,,,,,,,,,,,,,#..                    ",
   "                       .##,,,,,,,,,,,,,,,##.                     ",
   "                       ..##,,,,,,,,,,,,,##..                     ",
   "                        ...###,,,,,,,###...                      ",
   "                          ....#######....                        ",
   "                             .........                           ",
);

# Rotate the building somehow
gen->array_rotate(\@CASTLE, rand() >= 0.5 ? 0 : 2);

# Put some buildings on the level
gen->overlay_anywhere(\@CASTLE);

# Print the surface
gen->print_level();

#TODO Generate @CASTLE dynamically
