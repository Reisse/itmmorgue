#!/bin/sh
# vim: sw=4 ts=4 et :

OS=`uname -s`
EXECUTABLE='itmmorgue'
SRC='itmmorgue.c client.c'
SRCDIR='src'
WORKDIR='bin'

CC='gcc'
CFLAGS='-std=c99 -pedantic -Wall -Wextra -Werror -lncursesw -ggdb3'
LDFLAGS=''
MAKE='make'

case $OS in
    SunOS) 
        LDFLAGS="$LDFLAGS -L /opt/csw/lib/"
        CFLAGS="$CFLAGS -L /opt/csw/lib/ -I /opt/sfw/include/"
        MAKE=gmake
        ;;
    FreeBSD) echo Please add platfrom support! >&2 ; exit 2
        ;;
    Linux) echo Please add platfrom support! >&2 ; exit 2
        ;;
    *) echo Unsupported platform! >&2 ; exit 2
        ;;
esac

cat > Makefile <<EOF
# Makefile for $OS
EXECUTABLE=$EXECUTABLE
SRC=$SRC
SOURCES=\$(addprefix $SRCDIR/, \$(SRC))
OBJ=\$(SRC:.c=.o)
WORKDIR=$WORKDIR
OBJECTS=\$(addprefix \$(WORKDIR)/, \$(OBJ))

CC=$CC
CFLAGS=$CFLAGS
LDFLAGS=$LDFLAGS

all: \$(EXECUTABLE)

\$(WORKDIR):
	mkdir \$(WORKDIR)

\$(EXECUTABLE): \$(OBJECTS)
	\$(CC) \$(LDFLAGS) \$(CFLAGS) \$(OBJECTS) -o \$(WORKDIR)/\$@

\$(WORKDIR)/%.o : src/%.c
	\$(CC) \$(CFLAGS) -c \$< -o \$@

\$(SOURCES): \$(WORKDIR)

clean:
	\$(RM) -rf \$(WORKDIR)

.SUFFIXES: .c .o
EOF

echo "Successfully configured for $OS. Please run $MAKE now." >&2
